"0","# Read Match Stats and Betting data"
"0","EPL1819_all = fread(""season-1819_csv.csv"")"
"0","EPL1718_all = fread(""season-1718_csv.csv"")"
"0","EPL1617_all = fread(""season-1617_csv.csv"")"
"0","EPL1920_all = fread(""season-1920_csv.csv"")"
"0","setnames(EPL1920_all,c(""AvgA"",""AvgH"",""AvgD""), c(""BbAvA"",""BbAvH"",""BbAvD""))#Fix closing betting averages name changes from the 19/20 dataset"
"0",""
"0","# Seperate Modelling Data that doesn't need to be aggregated"
"0","modelCols = c(""HomeTeam"",""AwayTeam"",""FTR"",""BbAvH"",""BbAvD"",""BbAvA"")"
"0","EPL1617_mod = EPL1617_all[,..modelCols]"
"0","EPL1718_mod = EPL1718_all[,..modelCols]"
"0","EPL1819_mod = EPL1819_all[,..modelCols]"
"0","EPL1920_mod = EPL1920_all[,..modelCols]"
"0","modelData = rbind(EPL1617_mod, EPL1718_mod,EPL1819_mod ,EPL1920_mod)"
"0",""
"0","# Remove Extraneous columns"
"0","relevantColumns = c(""HomeTeam"",""AwayTeam"",""FTHG"",""FTAG"",""HTHG"",""HTAG"",""HS"",""AS"",""HST"",""AST"",""HF"",""AF"",""HC"",""AC"",""HY"",""AY"",""HR"",""AR"")"
"0","EPL1617 = EPL1617_all[,..relevantColumns]"
"0","EPL1718 = EPL1718_all[,..relevantColumns]"
"0","EPL1819 = EPL1819_all[,..relevantColumns]"
"0","EPL1920 = EPL1920_all[,..relevantColumns]"
"0",""
"0","# Load 538 spi ratings and xG data"
"0","spiMatches = fread(""spi_matches.csv"")"
"0","spiMatches = spiMatches[league == ""Barclays Premier League"",]"
"0",""
"0","# Format spi data to fit stats and betting data - Different team names in both data set"
"0","setnames(spiMatches,c(""team1"",""team2""), c(""HomeTeam"",""AwayTeam""))"
"0",""
"0","spiTeamToChange = c(""Hull City"", ""Manchester City"", ""AFC Bournemouth"",""Manchester United"", ""Leicester City"", ""Stoke City"", ""Swansea City"", ""Tottenham Hotspur"",""West Bromwich Albion"",""West Ham United"", ""Brighton and Hove Albion"", ""Huddersfield"", ""Wolverhampton"", ""Cardiff City"", ""Norwich City"")"
"0",""
"0","changeTo = c(""Hull"",""Man City"",""Bournemouth"", ""Man United"", ""Leicester"", ""Stoke"", ""Swansea"", ""Tottenham"",""West Brom"",""West Ham"",""Brighton"",""Huddersfield"",""Wolves"", ""Cardiff"", ""Norwich"")"
"0",""
"0","# Change team names to match"
"0","for(i in 1:length(spiTeamToChange)) {"
"0","  spiMatches[HomeTeam== spiTeamToChange[i],HomeTeam:=changeTo[i]]"
"0","  spiMatches[AwayTeam== spiTeamToChange[i],AwayTeam:=changeTo[i]]"
"0","}"
"0",""
"0","# Sort to match order - Betting data is sorted by date, then home team name."
"0","spiMatches[,date := as.Date(date,format=""%Y-%m-%d"")]"
"0","setorder(spiMatches, date, HomeTeam)"
